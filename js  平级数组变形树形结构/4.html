<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script>
      var data = [
     {id: 1, name: "安徽", key: 1},
     {id: 2, name: "江苏", key: 2},
    {id: 3, name: "合肥", pid: 1, key: 3},
    {id: 4, name: "庐阳区", pid: 3, key: 4},
    {id: 5, name: "大杨镇", pid: 4, key: 5},
    {id: 6, name: "南京", pid: 2, key: 6},
    {id: 7, name: "玄武区", pid: 6, key: 7},
    {id: 8, name: "梅园新村街道", pid: 7, key: 8},
     {id: 9, name: "上海", key: 9},
    {id: 10, name: "黄浦区", pid: 9, key: 10},
    {id: 11, name: "外滩", pid: 10, key: 11},
    {id: 12, name: "安庆", pid: 1, key: 12}
];
    var data1 = [{
        id: 1,
        address: "安徽",
        pid: 0
      },
      {
        id: 6,
        address: "安徽a",
        pid: 1
      },
      {
        id: 12,
        address: "安徽aa",
        pid: 6
      },
      {
        id: 14,
        address: "安徽aaa",
        pid: 12
      },
      {
        id: 15,
        address: "安徽aaaa",
        pid: 14
      },
      {
        id: 7,
        address: "安徽b",
        pid: 1
      },
      {
        id: 13,
        address: "安徽bb",
        pid: 7
      },
      {
        id: 2,
        address: "江苏",
        pid: 0
      },
      {
        id: 8,
        address: "江苏a",
        pid: 2
      },
      {
        id: 9,
        address: "江苏b",
        pid: 2
      },
      {
        id: 3,
        address: "合肥",
        pid: 0
      },
      {
        id: 10,
        address: "合肥a",
        pid: 3
      },
      {
        id: 11,
        address: "合肥b",
        pid: 3
      }
    ]
    
   function  toTree(data) {
      // 删除 所有 children,以防止多次调用
      data.forEach(function(item) {
        delete item.children;
      });
 
      // 将数据存储为 以 id 为 KEY 的 map 索引数据列
      var map = {};
      data.forEach(function(item) {
        map[item.id] = item;
      });
      //        console.log(map);
 
      var val = [];
      data.forEach(function(item) {
        // 以当前遍历项，的pid,去map对象中找到索引的id
        var parent = map[item.pid];
 
        // 如果找到索引，那么说明此项不在顶级当中,那么需要把此项添加到，他对应的父级中
        if (parent) {
          (parent.children || (parent.children = [])).push(item);
        } else {
          //如果没有在map中找到对应的索引ID,那么直接把 当前的item添加到 val结果集中，作为顶级
          val.push(item);
        }
      });
      return val;
    }

    var    result  = toTree(data)
    console.log(result)

  </script>
</body>

</html>
